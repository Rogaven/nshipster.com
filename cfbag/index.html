<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  
    <title>CFBag - NSHipster</title>
    <meta name="description" content="In the pantheon of collection data types in computer science, bag doesn't really have the same clout as lists, sets, associative arrays, trees, graphs, or priority queues. In fact, it's pretty obscure. You've probably never heard of it."/>
    <link rel="canonical" href="http://nshipster.com/cfbag/"/>
  
  
  
  
  <meta name="author" content="Mattt Thompson"/>
  
  <meta name="revisit-after" content="7 days"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"/>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://nshipster.com/feed.xml"/>
  <link rel="stylesheet" type="text/css" href="http://nshipster.com/css/screen.css"/>
  <link rel="apple-touch-icon" href="/touch-icon-iphone.png"/>
  <link rel="apple-touch-icon" sizes="76x76" href="/touch-icon-ipad.png"/>
  <link rel="apple-touch-icon" sizes="120x120" href="/touch-icon-iphone-retina.png"/>
  <link rel="apple-touch-icon" sizes="152x152" href="/touch-icon-ipad-retina.png"/>
  <link rel="icon" sizes="16x16 24x24 32x32 48x48 64x64" type="image/vnd.microsoft.icon" href="/favicon.ico"/>
  <link rel="mask-icon" sizes="any" href="/website_icon.svg" color="black"/>
  <link rel="author" type="text/plain" href="http://nshipster.com/humans.txt"/>

  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:site" content="@NSHipster"/>
  
  <meta name="twitter:creator" content="@mattt"/>
  
  
    <meta name="twitter:title" content="CFBag"/>
    <meta name="twitter:description" content="In the pantheon of collection data types in computer science, bag doesn&#39;t really have the same clout as lists, sets, associative arrays, trees, graphs, or priority queues. In fact, it&#39;s pretty obscure. You&#39;ve probably never heard of it."/>
  
  <meta property="twitter:account_id" content="629523445"/>

  <meta property="og:site_name" content="NSHipster"/>
  <meta property="og:image" content="http://nshipster.com/touch-icon-ipad-retina.png"/>
  
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="CFBag"/>
    <meta property="og:url" content="http://nshipster.com/cfbag/"/>
    <meta property="og:description" content="In the pantheon of collection data types in computer science, bag doesn&#39;t really have the same clout as lists, sets, associative arrays, trees, graphs, or priority queues. In fact, it&#39;s pretty obscure. You&#39;ve probably never heard of it."/>
    <meta property="article:published_time" content="2012-08-27T00:00:00-07:00"/>
    <meta property="article:modified_time" content="2015-12-09T21:34:50-08:00"/>
    <meta property="article:tag" content="cocoa"/>
    <meta property="article:publisher" content="https://www.facebook.com/NSHipster">
  

  
    <meta property="st:title" content="CFBag"/>
    <meta property="st:type" content="article"/>
  
  
  <meta property="nshipster:hide-single-lang" content="swift,objective-c"/>
</head>

<body itemscope itemtype="http://schema.org/WebPage">

  <script src="http://nshipster.com/js/zepto.min.js"></script>
  <script src="http://nshipster.com/js/application.js"></script>

  <div role="container">
    <header role="banner">
      <h1 id="logo">
        <a href="/">
          <svg id="ns" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 79.5 45.7" enable-background="new 0 0 79.5 45.7" xml:space="preserve">
<g>
  <path fill="#F58020" d="M0.6,1h13.7L27,24.4h0.1V1h12.7v43.6H26.8L13.4,20.8h-0.1v23.8H0.6V1z"/>
  <path fill="#F58020" d="M51.4,30c0,1.1,0.2,2.1,0.5,2.9c1,2.6,3.9,3.2,6.4,3.2c2.2,0,5.6-0.7,5.6-4c0-2.3-1.9-2.9-9.4-5
    c-6.9-2-14.8-3.8-14.8-12.6C39.7,4.3,48.3,0,57.3,0c9.5,0,17.8,3.6,18.2,14.2H62.8c0.2-1.6-0.5-2.7-1.6-3.5
    c-1.1-0.8-2.6-1.1-4-1.1c-1.8,0-4.8,0.5-4.8,2.9c0.2,3.1,6.5,3.8,12.6,5.5c6.2,1.7,12.3,4.6,12.3,12.6c0,11.4-10.4,15-20.1,15
    c-4.9,0-19-1.8-19.2-15.7H51.4z"/>
</g>
</svg>

          <svg id="mustache" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 79.5 45.7" enable-background="new 0 0 79.5 45.7" xml:space="preserve">
  <g transform="translate(0,-952.36217)" opacity="0.95">
    <path id="path2987" fill="#010101" d="M28.2,971.4c-10,0.5-19.1,13.3-28.2,2.1c0,15.1,23.7,30.5,39.8,16.3
      c16,14.1,39.8-1.3,39.8-16.3c-12.5,15.4-25-14.4-39.8,4.5C35.8,972.7,31.9,971.2,28.2,971.4z"/>
  </g>
</svg>

        </a>

        <span hidden style="display:none;">NSHipster</span>
      </h1>

      <form role="search">
        <input type="text" id="st-search-input" class="st-search-input" />
      </form>

      
    </header>

    <div id="main" role="main" itemprop="mainContentOfPage">
      

<article role="article" itemscope itemtype="http://schema.org/Article">
  <header role="heading">
    <h1 class="title" itemprop="name">
      <a href="/cfbag/">CFBag</a>
    </h1>

    <h2>
    
      Written by <a class="author" href="/authors/mattt-thompson/">Mattt Thompson</a> —
    
    <time datetime="2012-08-27T00:00:00-07:00" itemprop="datePublished">August 27<sup>th</sup>, 2012</time>
    
    </h2>

  </header>

  <div class="content" itemprop="articleBody" data-swiftype-index="true">
    <p>Objective-C is a language caught between two worlds.</p>

<p>On one side, it follows the thoughtful, object-oriented philosophy of <a href="http://en.wikipedia.org/wiki/Smalltalk">Smalltalk</a>, which brings ideas like message sending and named parameters. On the other, are the inescapable vestiges of <a href="http://en.wikipedia.org/wiki/C_(programming_language)">C</a>, which brings it power and a dash of chaos.</p>

<p>It&rsquo;s an identity crisis borne out through an ever-increasing prevalence of the <code>@</code> symbol.</p>

<p>This is also seen in the relationship between the Foundation and Core Foundation, particularly with the toll-free bridged collection class clusters: <code>NSArray</code> / <code>CFArray</code>, <code>NSDictionary</code> / <code>CFDictionary</code>, <code>NSSet</code> / <code>CFSet</code>. These collections can be passed back and forth between C functions and Objective-C methods without conversion. A leak in the abstraction, but a useful way to optimize the most critical parts of an application nonetheless.</p>

<p>However, toll-free bridging is the exception when it comes to collection classes in Foundation and Core Foundation:</p>

<table>
  <thead>
    <tr>
      <th>Foundation</th>
      <th>Core Foundation</th>
      <th>Toll-Free Bridged</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><tt>NSArray</tt><sup>*</sup></td>
      <td><tt>CFArray</tt><sup>*</sup></td>
      <td>✓</td>
    </tr>
    <tr>
      <td><tt>NSCountedSet</tt></td>
      <td><tt>CFBag</tt><sup>*</sup></td>
      <td></td>
    </tr>
    <tr>
      <td><em>N/A</em></td>
      <td><tt>CFBinaryHeap</tt></td>
      <td></td>
    </tr>
    <tr>
      <td><em>N/A</em></td>
      <td><tt>CFBitVector</tt><sup>*</sup></td>
      <td></td>
    </tr>
    <tr>
      <td><tt>NSDictionary</tt><sup>*</sup></td>
      <td><tt>CFDictionary</tt><sup>*</sup></td>
      <td>✓</td>
    </tr>
    <tr>
      <td><tt>NSIndexSet</tt><sup>*</sup></td>
      <td><em>N/A</em></td>
      <td></td>
    </tr>
    <tr>
      <td><tt>NSMapTable</tt></td>
      <td><em>N/A</em></td>
      <td></td>
    </tr>
    <tr>
      <td><tt>NSOrderedSet</tt></td>
      <td><em>N/A</em></td>
      <td></td>
    </tr>
    <tr>
      <td><tt>NSPointerArray</tt></td>
      <td><em>N/A</em></td>
      <td></td>
    </tr>
    <tr>
      <td><tt>NSPointerFunctions</tt></td>
      <td><em>N/A</em></td>
      <td></td>
    </tr>
    <tr>
      <td><tt>NSSet</tt><sup>*</sup></td>
      <td><tt>CFSet</tt><sup>*</sup></td>
      <td>✓</td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <td colspan="3"><sup>*</sup> Indicates Mutable Counterpart</td>
    </tr>
  </tfoot>
</table>

<p>Take a look at the second row, with <code>NSCountedSet</code> and <code>CFBag</code>. Notice that unlike the other Foundation / Core Foundation correspondence, these two are not toll-free bridged. No real explanation for this is provided in the documentation, aside from it being acknowledged in the <code>NSCountedSet</code> documentation. My guess is that it has something to do with <code>NSCountedSet</code> not having a mutable counterpart, and thus breaking the class cluster pattern seen in <code>NSArray</code>, et al.</p>

<h2 id="bags,-in-the-abstract">Bags, in the Abstract</h2>

<p>In the <a href="http://en.wikipedia.org/wiki/Collection_(abstract_data_type)">pantheon of collection data types</a> in computer science, bag doesn&rsquo;t really have the same clout as lists, sets, associative arrays, trees, graphs, or priority queues.</p>

<p>In fact, it&rsquo;s pretty obscure. You&rsquo;ve probably never heard of it.</p>

<p>A bag, or <a href="http://en.wikipedia.org/wiki/Multiset">multiset</a> is a variant of a set, where members can appear more than once. A count is associated with each unique member of the collection, representing the number of times it has been added. Like with sets, order does not matter.</p>

<p>Its practical applications are&hellip; limited, but you&rsquo;ll know one when it comes up. Tallying votes in a general election? Simulating homework problems an intro probability class? Implementing a game of Yahtzee? Bag is your new bicycle!</p>

<h2 id="working-with-cfmutablebag">Working with <code>CFMutableBag</code></h2>

<p>As an implementation of the bag data type, <code>CFBag</code> and its mutable counterpart, <code>CFMutableBag</code>, are pretty slick.</p>

<p>Although it lacks the object-oriented convenience of <code>NSCountedSet</code>, it makes up for it with a number of ways to customize its behavior. When <code>CFBag</code> is created, it can be initialized with a number of callbacks, defined by the <code>CFBagCallBacks</code> struct, which specify the way values are inserted, removed, and compared:</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="k">struct</span> <span class="n">CFBagCallBacks</span> <span class="p">{</span>
   <span class="n">CFIndex</span> <span class="n">version</span><span class="p">;</span>
   <span class="n">CFBagRetainCallBack</span> <span class="k">retain</span><span class="p">;</span>
   <span class="n">CFBagReleaseCallBack</span> <span class="k">release</span><span class="p">;</span>
   <span class="n">CFBagCopyDescriptionCallBack</span> <span class="n">copyDescription</span><span class="p">;</span>
   <span class="n">CFBagEqualCallBack</span> <span class="n">equal</span><span class="p">;</span>
   <span class="n">CFBagHashCallBack</span> <span class="n">hash</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">CFBagCallBacks</span> <span class="n">CFBagCallBacks</span><span class="p">;</span>
</code></pre></div>
<ul>
<li><code>retain</code>: callback used to retain values as they&rsquo;re added to the collection</li>
<li><code>release</code>: callback used to release values as they&rsquo;re removed from the collection</li>
<li><code>copyDescription</code>: callback used to create a string description of each value in the collection</li>
<li><code>equal</code>: callback used to compare values in the collection for equality</li>
<li><code>hash</code>: callback used to compute hash codes for values in the collection</li>
</ul>

<p>For example, if you were implementing a vote tallying application, you could specify a normalizing function for <code>retain</code> to ensure that votes for mixed-case or misspelled names went to the right candidate, or ensure that the &ldquo;correct&rdquo; candidate is shown to be the winner when all the votes are in, with <code>equal</code> callback.</p>

<p><code>CFMutableBag</code> also has <code>CFBagApplyFunction</code>, which has the ability to transform values over the collection, like if you wanted to smooth out vote counts, or something like that.</p>

<p>So in closing, if you need to rig an election, <code>CFBag</code> is your best bet.</p>

<hr>

<p>But seriously, <code>CFBag</code>, useful in its own right, serves as a reminder of the hidden gems to be found within the standard frameworks and libraries&ndash;indeed what is at the very heart of being an NSHipster.</p>

<p>Also, <code>CFBinaryHeap</code>? <code>NSPointerFunctions</code>? <code>NSMapTable</code>? Surely, you&rsquo;ll be seeing more of these in future editions.</p>

  </div>

  <footer role="complementary">
    
    <section id="revisions">
      <small>NSMutableHipster</small>

      <p>
      Questions? Corrections?  <a href="https://github.com/NSHipster/articles/issues">Issues</a> and <a href="https://github.com/NSHipster/articles/blob/master/2012-08-27-cfbag.md">pull requests</a> are always welcome — NSHipster is made better by readers like you.
      </p>
      
      <p>
      
        
            <em>This article uses Swift version t.b.c.</em>
        
      
      Find status information for all articles on the <a href="/status/">status page</a>.
      </p>
      
      <dl>
      
      </dl>
    </section>
    

    <section id="follow">
      <small>Follow NSHipster</small>

      <ul>
        <li class="twitter">
          <a href="https://twitter.com/intent/user?screen_name=NSHipster" title="Follow NSHipster on Twitter"><i class="icon-twitter" aria-hidden="true"></i></a>
        </li>
        <li class="facebook">
          <a href="https://www.facebook.com/NSHipster" title="Like NSHipster on Facebook"><i class="icon-facebook" aria-hidden="true"></i></a>
        </li>
        <li class="google-plus">
          <a href="https://plus.google.com/+NSHipster" title="Follow NSHipster on G+"><i class="icon-googleplus" aria-hidden="true"></i></a>
        </li>
        <li class="rss">
          <a href="/feed.xml" title="Subscribe to the NSHipster RSS Feed"><i class="icon-feed" aria-hidden="true"></i></a>
        </li>
      </ul>

      <form action="https://tinyletter.com/NSHipster" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/NSHipster', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
        <label for="tlemail" hidden style="display:none;">Enter Your Email Address</label>
        <input type="email" name="email" id="tlemail" placeholder="Your Email Address"/>
        <input type="hidden" name="embed" value="1"/>
        <input type="submit" value="Join the Newsletter"/>
      </form>
    </section>

    <section id="attribution">
      
  <div class="contributor" itemprop="author" itemscope itemtype="http://data-vocabulary.org/Person">
    <small>Written by</small>

    <img class="avatar" alt="Mattt Thompson" itemprop="image" src="http://nshipster.s3.amazonaws.com/mattt-thompson.jpg" draggable="false"/>
    <div class="details">
      <span itemprop="name"><a href="/authors/mattt-thompson/">Mattt Thompson</a></span>

      <p><a href="https://github.com/mattt">Mattt Thompson</a> (<a href="https://twitter.com/mattt">@mattt</a>) is a writer and developer from the Rustbelt.</p>


      
        <a href="https://plus.google.com/106751358503565042647?rel=author" rel="author"></a>
      
    </div>
  </div>


    </section>

    

    

    <section>
      <div id="continue">
        <small>Next Article</small>
        
        

          <article>
            <h1 class="title">
              <a href="/nslocale/" title="NSLocale" rel="next">NSLocale</a>
            </h1>

            <p>Internationalization is like flossing: everyone knows they should do it, but probably don&rsquo;t.</p>

          </article>
      </div>

      
      
        
        
      

      <div id="related">
        <small>Related Articles</small>

        <ul>
          
          
          
            <li>
              <a href="/addressbookui/" title="AddressBookUI">AddressBookUI</a>
            </li>
            
          
          
            <li>
              <a href="/nsurlcache/" title="NSURLCache">NSURLCache</a>
            </li>
            
          
          
            <li>
              <a href="/ns_enum-ns_options/" title="NS_ENUM & NS_OPTIONS">NS_ENUM & NS_OPTIONS</a>
            </li>
            
          
          
            <li>
              <a href="/nssecurecoding/" title="NSSecureCoding">NSSecureCoding</a>
            </li>
            
          
        </ul>
      </div>
    </section>
  </footer>
</article>

    </div>

    <footer role="contentinfo">
      <section class="credits colophon">
        <p>
          Questions? Corrections? <a href="https://twitter.com/NSHipster">@NSHipster</a> or <a href="https://github.com/NSHipster/articles">on GitHub</a>.
        </p>
        <p>
          <i aria-hidden="true" class="icon-cc"></i>
          <i aria-hidden="true" class="icon-cc-by"></i>
          <i aria-hidden="true" class="icon-cc-nc"></i>
          NSHipster.com is released under a <a href="http://creativecommons.org/licenses/by-nc/4.0/" rel="license">Creative Commons BY-NC License</a>.
        </p>
        <p><abbr title="International Standard Serial Number">ISSN</abbr> 2373-9800</p>
        <p lang="zh-Hans"><a href="http://nshipster.cn" hreflang="zh-Hans" title="Articles also available in Chinese">文章也可在中文版阅读</a>。</p>
        <a href="https://plus.google.com/105091289906267717942" rel="publisher"></a>
      </section>
    </footer>
  </div>

  <script>
    if (window.navigator && window.navigator.loadPurpose === "preview") {
      window.location.href = "http://nshipster.com/topsites_preview.html";
    }
  </script>

  <script async>
    var Swiftype = window.Swiftype || {};
    (function() {
      Swiftype.key = 'Q5jNBiR8qVs5xE5dNect';
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.async = true;
      script.src = "//swiftype.com/embed.js";
      var entry = document.getElementsByTagName('script')[0];
      document.getElementsByTagName('script')[0].parentNode.insertBefore(script, entry);
    }());
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-49868484-1', 'nshipster.com');
    ga('send', 'pageview');
  </script>

</body>
</html>
