<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  
    <title>Swift Collection Protocols - NSHipster</title>
    <meta name="description" content="Swift's collection protocols act like the steps on a ladder. With each step up, a collection type gains more functionality within the language and the standard library. This week we'll explore these protocols: what they are, how to conform to them, and what benefits they can provide for your own custom collection types."/>
    <link rel="canonical" href="http://nshipster.com/swift-collection-protocols/"/>
  
  
  
  
  <meta name="author" content="Nate Cook"/>
  
  <meta name="revisit-after" content="7 days"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"/>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://nshipster.com/feed.xml"/>
  <link rel="stylesheet" type="text/css" href="http://nshipster.com/css/screen.css"/>
  <link rel="apple-touch-icon" href="/touch-icon-iphone.png"/>
  <link rel="apple-touch-icon" sizes="76x76" href="/touch-icon-ipad.png"/>
  <link rel="apple-touch-icon" sizes="120x120" href="/touch-icon-iphone-retina.png"/>
  <link rel="apple-touch-icon" sizes="152x152" href="/touch-icon-ipad-retina.png"/>
  <link rel="icon" sizes="16x16 24x24 32x32 48x48 64x64" type="image/vnd.microsoft.icon" href="/favicon.ico"/>
  <link rel="mask-icon" sizes="any" href="/website_icon.svg" color="black"/>
  <link rel="author" type="text/plain" href="http://nshipster.com/humans.txt"/>

  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:site" content="@NSHipster"/>
  
  <meta name="twitter:creator" content="@nnnnnnnn"/>
  
  
    <meta name="twitter:title" content="Swift Collection Protocols"/>
    <meta name="twitter:description" content="Swift&#39;s collection protocols act like the steps on a ladder. With each step up, a collection type gains more functionality within the language and the standard library. This week we&#39;ll explore these protocols: what they are, how to conform to them, and what benefits they can provide for your own custom collection types."/>
  
  <meta property="twitter:account_id" content="629523445"/>

  <meta property="og:site_name" content="NSHipster"/>
  <meta property="og:image" content="http://nshipster.com/touch-icon-ipad-retina.png"/>
  
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Swift Collection Protocols"/>
    <meta property="og:url" content="http://nshipster.com/swift-collection-protocols/"/>
    <meta property="og:description" content="Swift&#39;s collection protocols act like the steps on a ladder. With each step up, a collection type gains more functionality within the language and the standard library. This week we&#39;ll explore these protocols: what they are, how to conform to them, and what benefits they can provide for your own custom collection types."/>
    <meta property="article:published_time" content="2015-02-23T00:00:00-08:00"/>
    <meta property="article:modified_time" content="2015-12-09T21:34:50-08:00"/>
    <meta property="article:tag" content="swift"/>
    <meta property="article:publisher" content="https://www.facebook.com/NSHipster">
  

  
    <meta property="st:title" content="Swift Collection Protocols"/>
    <meta property="st:type" content="article"/>
  
  
  <meta property="nshipster:hide-single-lang" content="swift"/>
</head>

<body itemscope itemtype="http://schema.org/WebPage">

  <script src="http://nshipster.com/js/zepto.min.js"></script>
  <script src="http://nshipster.com/js/application.js"></script>

  <div role="container">
    <header role="banner">
      <h1 id="logo">
        <a href="/">
          <svg id="ns" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 79.5 45.7" enable-background="new 0 0 79.5 45.7" xml:space="preserve">
<g>
  <path fill="#F58020" d="M0.6,1h13.7L27,24.4h0.1V1h12.7v43.6H26.8L13.4,20.8h-0.1v23.8H0.6V1z"/>
  <path fill="#F58020" d="M51.4,30c0,1.1,0.2,2.1,0.5,2.9c1,2.6,3.9,3.2,6.4,3.2c2.2,0,5.6-0.7,5.6-4c0-2.3-1.9-2.9-9.4-5
    c-6.9-2-14.8-3.8-14.8-12.6C39.7,4.3,48.3,0,57.3,0c9.5,0,17.8,3.6,18.2,14.2H62.8c0.2-1.6-0.5-2.7-1.6-3.5
    c-1.1-0.8-2.6-1.1-4-1.1c-1.8,0-4.8,0.5-4.8,2.9c0.2,3.1,6.5,3.8,12.6,5.5c6.2,1.7,12.3,4.6,12.3,12.6c0,11.4-10.4,15-20.1,15
    c-4.9,0-19-1.8-19.2-15.7H51.4z"/>
</g>
</svg>

          <svg id="mustache" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 79.5 45.7" enable-background="new 0 0 79.5 45.7" xml:space="preserve">
  <g transform="translate(0,-952.36217)" opacity="0.95">
    <path id="path2987" fill="#010101" d="M28.2,971.4c-10,0.5-19.1,13.3-28.2,2.1c0,15.1,23.7,30.5,39.8,16.3
      c16,14.1,39.8-1.3,39.8-16.3c-12.5,15.4-25-14.4-39.8,4.5C35.8,972.7,31.9,971.2,28.2,971.4z"/>
  </g>
</svg>

        </a>

        <span hidden style="display:none;">NSHipster</span>
      </h1>

      <form role="search">
        <input type="text" id="st-search-input" class="st-search-input" />
      </form>

      
    </header>

    <div id="main" role="main" itemprop="mainContentOfPage">
      

<article role="article" itemscope itemtype="http://schema.org/Article">
  <header role="heading">
    <h1 class="title" itemprop="name">
      <a href="/swift-collection-protocols/">Swift Collection Protocols</a>
    </h1>

    <h2>
    
      Written by <a class="author" href="/authors/nate-cook/">Nate Cook</a> —
    
    <time datetime="2015-02-23T00:00:00-08:00" itemprop="datePublished">February 23<sup>rd</sup>, 2015</time>
    
    </h2>

  </header>

  <div class="content" itemprop="articleBody" data-swiftype-index="true">
    <p>Swift has a well-designed and expansive suite of built-in collection types. Beyond <code>Array</code>, <code>Dictionary</code>, and the brand new <code>Set</code> types, the standard library provides slices, lazy collections, repeated sequences, and more, all with a consistent interface and syntax for operations. A group of built-in collection protocols—<code>SequenceType</code>, <code>CollectionType</code>, and several others—act like the steps on a ladder. With each step up, a collection type gains more functionality within the language and the standard library.</p>

<p>By conforming to these protocols, custom collection types can gain access to the same language constructs and powerful top-level functions we use with <code>Array</code> and <code>Dictionary</code>. This week we&rsquo;ll explore these protocols: what they are, how to conform to them, and what benefits they can provide for your own custom collection types.</p>

<hr>

<p>To demonstrate the different protocols, along the way we&rsquo;ll build a new collection type, <code>SortedCollection</code>, which keeps its elements in ascending order for simple, always-sorted access. The implementation shown here is deliberately kept minimal—you can only create a collection and insert, remove, or find elements:</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">struct</span> <span class="n">SortedCollection</span><span class="o">&lt;</span><span class="nl">T</span><span class="p">:</span> <span class="n">Comparable</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kr">private</span> <span class="k">var</span> <span class="nl">contents</span><span class="p">:</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">init</span><span class="o">&lt;</span><span class="nl">S</span> <span class="p">:</span> <span class="n">SequenceType</span> <span class="k">where</span> <span class="n">S</span><span class="p">.</span><span class="n">Generator</span><span class="p">.</span><span class="n">Element</span> <span class="o">==</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nl">sequence</span><span class="p">:</span> <span class="n">S</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">sorted</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">func</span> <span class="n">indexOf</span><span class="p">(</span><span class="nl">value</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Int</span><span class="o">?</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">index</span> <span class="o">=</span> <span class="n">_insertionIndex</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="nl">forValue</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">contents</span><span class="p">.</span><span class="n">count</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">nil</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">contents</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span> <span class="o">?</span> <span class="nl">index</span> <span class="p">:</span> <span class="nb">nil</span>
    <span class="p">}</span>

    <span class="kr">mutating</span> <span class="k">func</span> <span class="n">insert</span><span class="p">(</span><span class="nl">value</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">contents</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nl">atIndex</span><span class="p">:</span> <span class="n">_insertionIndex</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="nl">forValue</span><span class="p">:</span> <span class="n">value</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="kr">mutating</span> <span class="k">func</span> <span class="n">remove</span><span class="p">(</span><span class="nl">value</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="o">?</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="n">index</span> <span class="o">=</span> <span class="n">indexOf</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">contents</span><span class="p">.</span><span class="n">removeAtIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">nil</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Note: _insertionIndex is a private function that returns the </span>
<span class="c1">// insertion point for a value in a sorted collection.</span>
</code></pre></div>
<blockquote>
<p>A complete implementation of <code>SortedCollection</code> <a href="https://github.com/natecook1000/SortedCollection">is available as a framework</a>.</p>
</blockquote>

<p>Not too much there! Let&rsquo;s see what kind of functionality we can add by conforming to a few of Swift&rsquo;s collection protocols.</p>

<hr>

<h2 id="sequencetype-/-generatortype">SequenceType / GeneratorType</h2>

<p>The first two collection protocols are inextricably linked: a <em>sequence</em> (a type that conforms to <code>SequenceType</code> ) represents a series of values, while a <em>generator</em> (conforming to <code>GeneratorType</code>, of course) provides a way to use the values in a sequence, one at a time, in sequential order. The <code>SequenceType</code> protocol only has one requirement: every sequence must provide a generator from its <code>generate()</code> method.</p>

<p>A generator works by providing a single method, namely, <code>next()</code>, which simply returns the next value from the underlying sequence. <code>next()</code> will continue returning values until there are none left (), at which point it will return <code>nil</code>. Note that this may never comes to pass, since sequences aren&rsquo;t necessarily finite. </p>

<p>Whenever you iterate over a sequence, Swift creates a generator and successively calls its <code>next()</code> method. The familiar code <code>for element in myArray { ... }</code> is in fact just a nice wrapper for this:</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">var</span> <span class="n">generator</span> <span class="o">=</span> <span class="n">myArray</span><span class="p">.</span><span class="n">generate</span><span class="p">()</span>
<span class="k">while</span> <span class="k">let</span> <span class="n">element</span> <span class="o">=</span> <span class="n">generator</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// do something</span>
<span class="p">}</span>
</code></pre></div>
<p>The relationship between the two protocols is asymmetrical. That is, every sequence has a generator, but only some generators are themselves also sequences (which they can become by returning themselves from their <code>generate()</code> method). Swift includes a whole host of generators, including one that is perfect for our <code>SortedCollection</code> case: the type-erasing <code>GeneratorOf</code>. <code>GeneratorOf</code> is initialized with either the <code>next</code> method implemented as a closure, or another generator:</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">extension</span> <span class="nl">SortedCollection</span> <span class="p">:</span> <span class="n">SequenceType</span> <span class="p">{</span>
    <span class="k">typealias</span> <span class="n">Generator</span> <span class="o">=</span> <span class="n">GeneratorOf</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>

    <span class="k">func</span> <span class="n">generate</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Generator</span> <span class="p">{</span>
        <span class="k">var</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">GeneratorOf</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">self</span><span class="p">.</span><span class="n">contents</span><span class="p">.</span><span class="n">count</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">contents</span><span class="p">[</span><span class="n">index</span><span class="o">++</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nb">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Ten lines of code later, we can now use <code>SortedCollection</code> with a dozen or so top-level functions, including the bedrock of the functional approach in Swift—<code>reduce</code>, <code>map</code>, and <code>filter</code>. </p>

<blockquote>
<ul>
<li><a href="http://swiftdoc.org/func/contains/"><code>contains</code></a>: Returns true if (1) a particular given element is found in the sequence or (2) an element satisfies the given predicate closure.</li>
<li><a href="http://swiftdoc.org/func/enumerate/"><code>enumerate</code></a>: Converts a sequence into a sequence of tuples, where each tuple is made up of a zero-based index and the value at that index in the sequence.</li>
<li><a href="http://swiftdoc.org/func/filter/"><code>filter</code></a>: Converts a sequence to an <code>Array</code>, keeping only the elements that match the given predicate closure.</li>
<li><a href="http://swiftdoc.org/func/join/"><code>join</code></a>: Creates a collection from the sequence, with a given initial collection interposed between each element of the sequence. The initial element must be an <code>ExtensibleCollectionType</code>, described below.</li>
<li><a href="http://swiftdoc.org/func/lazy/"><code>lazy</code></a>: Creates a &ldquo;lazy sequence&rdquo; from the given sequence. Subsequent calls to <code>map</code>, <code>filter</code>, and <code>reverse</code> on the sequence will be evaluated lazily—that is, until you access or iterate over the sequence, none of the transformations will be executed.</li>
<li><a href="http://swiftdoc.org/func/map/"><code>map</code></a>: Converts a sequence to an <code>Array</code> after mapping each element with the transforming closure given.</li>
<li><a href="http://swiftdoc.org/func/maxElement/"><code>maxElement</code></a>: Returns the maximum value of a sequence of <code>Comparable</code> elements.</li>
<li><a href="http://swiftdoc.org/func/minElement/"><code>minElement</code></a>: Returns the minimum value of a sequence of <code>Comparable</code> elements.</li>
<li><a href="http://swiftdoc.org/func/reduce/"><code>reduce</code></a>: Given an initial value and a combining closure, this &ldquo;reduces&rdquo; a sequence to a single element through repeated calls to the closure.</li>
<li><a href="http://swiftdoc.org/func/sorted/"><code>sorted</code></a>: Returns a sorted <code>Array</code> of the sequence&rsquo;s elements. Sorting is automatically ascending for sequences of <code>Comparable</code> elements, or it can be based on a comparison closure.</li>
<li><a href="http://swiftdoc.org/func/startsWith/"><code>startsWith</code></a>: Returns true if one sequence starts with another sequence.</li>
<li><a href="http://swiftdoc.org/func/underestimateCount/"><code>underestimateCount</code></a>: Returns an <em>underestimate</em> of the number of elements in a sequence (<code>SequenceType</code>s give no hints about length, so this will be zero for a sequence). Returns the actual count for <code>CollectionType</code> instances.</li>
<li><a href="http://swiftdoc.org/func/zip/"><code>zip</code></a>: Converts two sequences into a sequence of tuples, where each tuple is made up of one element from each sequence.</li>
</ul>
</blockquote>

<h2 id="collectiontype-/-mutablecollectiontype">CollectionType / MutableCollectionType</h2>

<p>A <em>collection</em> (a type that conforms to the next collection protocol, <code>CollectionType</code>) is a step beyond a sequence in that individual elements of a collection can be accessed multiple times via subscript. A type conforms by providing a subscripted getter for elements, then starting and ending index properties. No infinite collections here! A <code>MutableCollectionType</code> adds a setter for the same subscript.</p>

<p>Our <code>SortedCollection</code> can easily use <code>Int</code> for its index, so conforming to <code>CollectionType</code> is straightforward:</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">extension</span> <span class="nl">SortedCollection</span> <span class="p">:</span> <span class="n">CollectionType</span> <span class="p">{</span>
    <span class="k">typealias</span> <span class="n">Index</span> <span class="o">=</span> <span class="n">Int</span>

    <span class="k">var</span> <span class="nl">startIndex</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nl">endIndex</span><span class="p">:</span> <span class="n">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">count</span>
    <span class="p">}</span>

    <span class="k">subscript</span><span class="p">(</span><span class="nl">i</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">contents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<p>Subscripting should always be considered an <em>O(1)</em> operation. Types that can&rsquo;t provide efficient subscripted lookups should move the time-consuming work to the process of generating.</p>

<p>Swift&rsquo;s built-in <code>String</code>, for example, lost its <code>Int</code>-based subscripting in an early beta. Why? Strings in Swift are fully Unicode-aware, so each visible character may be made up of multiple codepoints. Jumping to an arbitrary index in a string as if it were just an array of characters could land you in the middle of a multi-codepoint sequence, requiring the slightly cumbersome but intuitively <em>O(n)</em> use of <code>startIndex</code>, <code>endIndex</code>, and <code>advance()</code>.</p>
</blockquote>

<p>Like <code>SequenceType</code>, there are a host of global functions that can operate on <code>CollectionType</code> instances. Now that the start and end of the collection are known, <code>count</code>, <code>sort</code>, and other finite operations become available as top-level functions:</p>

<blockquote>
<ul>
<li><a href="http://swiftdoc.org/func/count/"><code>count</code></a>: Returns the number of elements in a collection.</li>
<li><a href="http://swiftdoc.org/func/find/"><code>find</code></a>: Returns the first index of a given element in the collection, or <code>nil</code> if not found.</li>
<li><a href="http://swiftdoc.org/func/first/"><code>first</code></a>: Returns the first element in the collection, or <code>nil</code> if the collection is empty.</li>
<li><a href="http://swiftdoc.org/func/indices/"><code>indices</code></a>: Returns a <code>Range</code> of the collection&rsquo;s indices. Equivalent to <code>c.startIndex..&lt;c.endIndex</code>.</li>
<li><a href="http://swiftdoc.org/func/isEmpty/"><code>isEmpty</code></a>: Returns true if the collection has no elements.</li>
<li><a href="http://swiftdoc.org/func/last/"><code>last</code></a>: Returns the last element in the collection, or <code>nil</code> if the collection is empty.</li>
<li><a href="http://swiftdoc.org/func/partition/"><code>partition</code></a>: The primary function used in a <em>quick sort</em> (a fast, memory-efficient sorting algorithm). <code>partition</code> reorders part of a collection and returns a pivot index, where everything below the pivot is equal to or ordered before the pivot, and everything above the pivot is equal to or ordered after. Partitioning can be based on a comparison closure if the collection&rsquo;s elements themselves are not <code>Comparable</code>. Requires <code>MutableCollectionType</code>.</li>
<li><a href="http://swiftdoc.org/func/reverse/"><code>reverse</code></a>: Returns an <code>Array</code> with the elements of the collection in reverse order.</li>
<li><a href="http://swiftdoc.org/func/sort/"><code>sort</code></a>: Sorts a collection in place, modifying the order of the existing collection. Requires <code>MutableCollectionType</code>.</li>
</ul>
</blockquote>

<h2 id="sliceable-/-mutablesliceable">Sliceable / MutableSliceable</h2>

<p>Next up, <code>Sliceable</code> collections promise <em>efficient</em> slicing of a subrange of a collection&rsquo;s elements. That is, getting a slice of a collection should not require allocating new memory for the selected elements. Again, the standard library guides us: <code>Array</code> and <code>ContiguousArray</code> are the two <code>Sliceable</code> types (besides, well, <code>Slice</code>), and both share their internal storage with their slices until a mutation occurs. This saves both memory and the time needed to allocate new storage for a temporary slice.</p>

<p>For <code>SortedCollection</code> to conform to  <code>Sliceable</code>, we need to fulfill that same promise.  Happily, we can reuse our embedded <code>Array</code>&rsquo;s sliceability in a new <code>SortedSlice</code> type, this time based on a <code>Slice&lt;T&gt;</code> instead of an <code>Array</code>: </p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">extension</span> <span class="nl">SortedCollection</span> <span class="p">:</span> <span class="n">Sliceable</span> <span class="p">{</span>
    <span class="k">typealias</span> <span class="n">SubSlice</span> <span class="o">=</span> <span class="n">SortedSlice</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>

    <span class="k">subscript</span><span class="p">(</span><span class="nl">range</span><span class="p">:</span> <span class="n">Range</span><span class="o">&lt;</span><span class="n">Int</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SortedSlice</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">SortedSlice</span><span class="p">(</span><span class="nl">sortedSlice</span><span class="p">:</span> <span class="n">contents</span><span class="p">[</span><span class="n">range</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - SortedSlice</span>

<span class="k">struct</span> <span class="n">SortedSlice</span><span class="o">&lt;</span><span class="nl">T</span><span class="p">:</span> <span class="n">Comparable</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kr">private</span> <span class="k">var</span> <span class="nl">contents</span><span class="p">:</span> <span class="n">Slice</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="kr">private</span> <span class="k">init</span><span class="p">(</span><span class="nl">sortedSlice</span><span class="p">:</span> <span class="n">Slice</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">self</span><span class="p">.</span><span class="n">contents</span> <span class="o">=</span> <span class="n">sortedSlice</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<p>For other custom collections, Swift 1.2 provides a <code>ManagedBufferPointer</code> type and an <code>isUniquelyReferenced</code> function to help implement the copy-on-write behavior needed for efficient slicing.</p>
</blockquote>

<p><code>Sliceable</code>&rsquo;s mutable counterpart, <code>MutableSliceable</code>, allows setting a slice&rsquo;s new contents via subscripting a range of values. Again, mutating by index doesn&rsquo;t comport with <code>SortedCollections</code>&rsquo;s requirement to always maintain ascending order. However, none of the <code>Sliceable</code>-ready top-level functions requires mutability:</p>

<blockquote>
<ul>
<li><a href="http://swiftdoc.org/func/dropFirst/"><code>dropFirst</code></a>: Returns a slice with all but the first element of the collection.</li>
<li><a href="http://swiftdoc.org/func/dropLast/"><code>dropLast</code></a>: Returns a slice with all but the last element of the collection.</li>
<li><a href="http://swiftdoc.org/func/prefix/"><code>prefix</code></a>: Returns a slice with the first <code>x</code> elements of the collection or the whole collection if <code>x</code> is greater than the collection&rsquo;s count.</li>
<li><a href="http://swiftdoc.org/func/split/"><code>split</code></a>: Returns an <code>Array</code> of slices separated by elements that match the given <code>isSeparator</code> closure. Optional parameters: a maximum number of splits; a boolean indicating whether empty slices are allowed when consecutive separators are found.</li>
<li><a href="http://swiftdoc.org/func/suffix/"><code>suffix</code></a>: Returns a slice with the last <code>x</code> elements of the collection or the whole collection if <code>x</code> is greater than the collection&rsquo;s count.</li>
</ul>
</blockquote>

<h2 id="extensiblecollectiontype-/-rangereplaceablecollectiontype">ExtensibleCollectionType / RangeReplaceableCollectionType</h2>

<p>Finally, collections that conform to <code>ExtensibleCollectionType</code> and <code>RangeReplaceableCollectionType</code> provide methods to modify the collection. <code>ExtensibleCollectionType</code> requires an empty initializer and three methods: <code>append</code> and <code>extend</code>, which add a single element and a sequence of elements, respectively, and <code>reserveCapacity</code>, which (hopefully) expands the collection&rsquo;s internal storage to allow additions to the collection without repeatedly reallocating memory.</p>

<p><code>RangeReplaceableCollectionType</code> requires six methods that replace or remove a range of elements: <code>replaceRange(:with:)</code>, <code>insert(:atIndex:)</code>, <code>splice(:atIndex:)</code>, <code>removeAtIndex(:)</code>, <code>removeRange(:)</code>, and <code>removeAll()</code>. Conforming types have access to top-level functions that do largely the same:</p>

<blockquote>
<ul>
<li><a href="http://swiftdoc.org/func/extend/"><code>extend</code></a>: Appends the elements of a collection to a given range-replaceable collection.</li>
<li><a href="http://swiftdoc.org/func/insert/"><code>insert</code></a>: Inserts a new element into the collection at a particular index.</li>
<li><a href="http://swiftdoc.org/func/removeAll/"><code>removeAll</code></a>: Removes all elements from a collection, optionally preserving the collection&rsquo;s internal capacity.</li>
<li><a href="http://swiftdoc.org/func/removeLast/"><code>removeLast</code></a>: Removes a single element from the end of a collection.</li>
<li><a href="http://swiftdoc.org/func/removeRange/"><code>removeRange</code></a>: Removes a range of elements from a collection.</li>
<li><a href="http://swiftdoc.org/func/splice/"><code>splice</code></a>: Inserts a sequence of elements at a particular index of a range-replaceable collection.</li>
</ul>
</blockquote>

<hr>

<h2 id="sorting-out-the-oscars">Sorting Out the Oscars</h2>

<p>So let&rsquo;s put all this to (popcultural) use. We haven&rsquo;t added any methods to <code>SortedCollection</code> other than those required to conform to <code>SequenceType</code>, <code>CollectionType</code>, and <code>Sliceable</code>, but yet we&rsquo;ve gained access to many powerful top-level functions.</p>

<p>We start with the guest list of an after-party for some of last night&rsquo;s big winners at the Oscars:</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="n">attendees</span> <span class="o">=</span> <span class="n">SortedCollection</span><span class="p">([</span><span class="s">&quot;Julianne&quot;</span><span class="p">,</span> <span class="s">&quot;Eddie&quot;</span><span class="p">,</span> <span class="s">&quot;Patricia&quot;</span><span class="p">,</span> <span class="s">&quot;J.K.&quot;</span><span class="p">,</span> <span class="s">&quot;Alejandro&quot;</span><span class="p">])</span>
</code></pre></div>
<p>How many attendees? Using <code>count</code>:</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="n">println</span><span class="p">(</span><span class="s">&quot;\(count(attendees)) attendees&quot;</span><span class="p">)</span>
<span class="c1">// 5 attendees</span>
</code></pre></div>
<p>Suppose I&rsquo;d like the stars to line up alphabetically for a photo—how can I give them instructions? Using <code>zip</code> and <code>dropFirst</code>:</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">for</span> <span class="p">(</span><span class="n">firstName</span><span class="p">,</span> <span class="n">secondName</span><span class="p">)</span> <span class="k">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">attendees</span><span class="p">,</span> <span class="n">dropFirst</span><span class="p">(</span><span class="n">attendees</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">println</span><span class="p">(</span><span class="s">&quot;\(firstName) is before \(secondName)&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// Alejandro is before Eddie</span>
<span class="c1">// Eddie is before J.K.</span>
<span class="c1">// J.K. is before Julianne</span>
<span class="c1">// Julianne is before Patricia</span>
</code></pre></div>
<p>Lastly, I need the names to be reformatted so I can use them as image file names. Using <code>map</code>:</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="n">imageNames</span> <span class="o">=</span> <span class="n">map</span><span class="p">(</span><span class="n">attendees</span><span class="p">)</span> <span class="p">{</span> <span class="err">$</span><span class="mf">0.</span><span class="n">lowercaseString</span> <span class="p">}</span>
        <span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="err">$</span><span class="mf">0.</span><span class="n">stringByTrimmingCharactersInSet</span><span class="p">(</span><span class="bp">NSCharacterSet</span><span class="p">.</span><span class="n">alphanumericCharacterSet</span><span class="p">().</span><span class="n">invertedSet</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="s">&quot;\($0).jpg&quot;</span> <span class="p">}</span>
<span class="c1">// alejandro.jpg</span>
<span class="c1">// eddie.jpg</span>
<span class="c1">// ...</span>
</code></pre></div>
<p><em>Voila!</em> A-list party!</p>

<hr>

<p>Without a doubt, part of what makes Swift so fascinating to use is that the language seems largely self-defined. Browse through the standard library and you can see how each type is built—from <code>Int</code> and <code>Double</code> to <code>Array</code>, <code>Dictionary</code>, and the new <code>Set</code>. With an eye toward building more Swift-native types, follow Swift&rsquo;s example in creating your own!</p>

  </div>

  <footer role="complementary">
    
    <section id="revisions">
      <small>NSMutableHipster</small>

      <p>
      Questions? Corrections?  <a href="https://github.com/NSHipster/articles/issues">Issues</a> and <a href="https://github.com/NSHipster/articles/blob/master/2015-02-23-swift-collection-protocols.md">pull requests</a> are always welcome — NSHipster is made better by readers like you.
      </p>
      
      <p>
      
        
            <em>This article uses Swift version 1.2.</em>
        
      
      Find status information for all articles on the <a href="/status/">status page</a>.
      </p>
      
      <dl>
      
      </dl>
    </section>
    

    <section id="follow">
      <small>Follow NSHipster</small>

      <ul>
        <li class="twitter">
          <a href="https://twitter.com/intent/user?screen_name=NSHipster" title="Follow NSHipster on Twitter"><i class="icon-twitter" aria-hidden="true"></i></a>
        </li>
        <li class="facebook">
          <a href="https://www.facebook.com/NSHipster" title="Like NSHipster on Facebook"><i class="icon-facebook" aria-hidden="true"></i></a>
        </li>
        <li class="google-plus">
          <a href="https://plus.google.com/+NSHipster" title="Follow NSHipster on G+"><i class="icon-googleplus" aria-hidden="true"></i></a>
        </li>
        <li class="rss">
          <a href="/feed.xml" title="Subscribe to the NSHipster RSS Feed"><i class="icon-feed" aria-hidden="true"></i></a>
        </li>
      </ul>

      <form action="https://tinyletter.com/NSHipster" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/NSHipster', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
        <label for="tlemail" hidden style="display:none;">Enter Your Email Address</label>
        <input type="email" name="email" id="tlemail" placeholder="Your Email Address"/>
        <input type="hidden" name="embed" value="1"/>
        <input type="submit" value="Join the Newsletter"/>
      </form>
    </section>

    <section id="attribution">
      
  <div class="contributor" itemprop="author" itemscope itemtype="http://data-vocabulary.org/Person">
    <small>Written by</small>

    <img class="avatar" alt="Nate Cook" itemprop="image" src="http://nshipster.s3.amazonaws.com/nate-cook.jpg" draggable="false"/>
    <div class="details">
      <span itemprop="name"><a href="/authors/nate-cook/">Nate Cook</a></span>

      <p><a href="http://natecook.com">Nate Cook</a> (<a href="https://twitter.com/nnnnnnnn">@nnnnnnnn</a>) is an independent web and application developer who <a href="http://natecook.com/blog/">writes frequently about topics in Swift</a>, and the creator of <a href="http://swiftdoc.org">SwiftDoc.org</a>.</p>


      
        <a href="https://plus.google.com/?rel=author" rel="author"></a>
      
    </div>
  </div>


    </section>

    
        

  <section id="promotion">
    
    <small>Recommended Reading</small>
    
    
    

<div id="" class="book" itemscope itemtype="http://schema.org/Product">
  <div itemscope itemtype="http://schema.org/Book">
    <link itemprop="bookFormat" href="http://schema.org/EBook"/>
    <a href="https://gum.co/nshipster-swift/" title="NSHipster: Obscure Topics in Cocoa & Swift" target="_blank">
      <img src="//cdn.nshipster.com/images/nshipster-swift-cover@2x.png" class="cover" alt="NSHipster: Obscure Topics in Cocoa & Swift" itemprop="image"/>
    </a>
    <span itemprop="name" style="display:none;" hidden>NSHipster: Obscure Topics in Cocoa & Swift</span>
    <span itemprop="author" style="display:none;" hidden>Mattt Thompson & Nate Cook</span>
    <div itemprop="offers" itemscope itemtype="http://schema.org/Offer" style="display:none;">
      <link itemprop="availability" href="http://schema.org/InStock"/>
      <meta itemprop="priceCurrency" content="USD"/>
      <span itemprop="price">29</span>
    </div>
  </div>
</div>

    <h3>NSHipster, Second Edition</h3>
    <h4>Obscure Topics in Cocoa & Swift</h4>
    <p>Revised and extended to focus on using Swift in iOS and OS X development, NSHipster: Obscure Topics in Cocoa &amp; Swift is an essential updated guide.</p>

    
    <a class="buy" href="https://gum.co/nshipster-swift/" target="_blank">Buy Now on Gumroad</a>
    
  </section>

    

    

    <section>
      <div id="continue">
        <small>Next Article</small>
        
        

          <article>
            <h1 class="title">
              <a href="/nsscanner/" title="NSScanner" rel="next">NSScanner</a>
            </h1>

            <p>Being able to pull apart strings and extract particular bits of data is a powerful skill, one that we use over and over building apps and shaping our tools. Cocoa provides a powerful set of frameworks to handle string processing. This week&rsquo;s article focuses on <code>NSScanner</code>, a highly configurable tool designed for extracting substrings and numeric values from loosely demarcated strings.</p>

          </article>
      </div>

      
      
        
        
      

      <div id="related">
        <small>Related Articles</small>

        <ul>
          
          
          
            <li>
              <a href="/swift-comparison-protocols/" title="Swift Comparison Protocols">Swift Comparison Protocols</a>
            </li>
            
          
          
            <li>
              <a href="/swift-system-version-checking/" title="Swift System Version Checking">Swift System Version Checking</a>
            </li>
            
          
          
            <li>
              <a href="/guard-and-defer/" title="guard & defer">guard & defer</a>
            </li>
            
          
          
            <li>
              <a href="/nscalendarunityear/" title="NSCalendarUnitYear">NSCalendarUnitYear</a>
            </li>
            
          
        </ul>
      </div>
    </section>
  </footer>
</article>

    </div>

    <footer role="contentinfo">
      <section class="credits colophon">
        <p>
          Questions? Corrections? <a href="https://twitter.com/NSHipster">@NSHipster</a> or <a href="https://github.com/NSHipster/articles">on GitHub</a>.
        </p>
        <p>
          <i aria-hidden="true" class="icon-cc"></i>
          <i aria-hidden="true" class="icon-cc-by"></i>
          <i aria-hidden="true" class="icon-cc-nc"></i>
          NSHipster.com is released under a <a href="http://creativecommons.org/licenses/by-nc/4.0/" rel="license">Creative Commons BY-NC License</a>.
        </p>
        <p><abbr title="International Standard Serial Number">ISSN</abbr> 2373-9800</p>
        <p lang="zh-Hans"><a href="http://nshipster.cn" hreflang="zh-Hans" title="Articles also available in Chinese">文章也可在中文版阅读</a>。</p>
        <a href="https://plus.google.com/105091289906267717942" rel="publisher"></a>
      </section>
    </footer>
  </div>

  <script>
    if (window.navigator && window.navigator.loadPurpose === "preview") {
      window.location.href = "http://nshipster.com/topsites_preview.html";
    }
  </script>

  <script async>
    var Swiftype = window.Swiftype || {};
    (function() {
      Swiftype.key = 'Q5jNBiR8qVs5xE5dNect';
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.async = true;
      script.src = "//swiftype.com/embed.js";
      var entry = document.getElementsByTagName('script')[0];
      document.getElementsByTagName('script')[0].parentNode.insertBefore(script, entry);
    }());
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-49868484-1', 'nshipster.com');
    ga('send', 'pageview');
  </script>

</body>
</html>
