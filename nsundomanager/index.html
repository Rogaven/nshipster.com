<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  
    <title>NSUndoManager - NSHipster</title>
    <meta name="description" content="We all make mistakes. Thankfully, Foundation comes to our rescue for more than just our misspellings. Cocoa includes a simple yet robust API for undoing or redoing actions through NSUndoManager."/>
    <link rel="canonical" href="http://nshipster.com/nsundomanager/"/>
  
  
  
  
  <meta name="author" content="Delisa Mason"/>
  
  <meta name="revisit-after" content="7 days"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"/>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://nshipster.com/feed.xml"/>
  <link rel="stylesheet" type="text/css" href="http://nshipster.com/css/screen.css"/>
  <link rel="apple-touch-icon" href="/touch-icon-iphone.png"/>
  <link rel="apple-touch-icon" sizes="76x76" href="/touch-icon-ipad.png"/>
  <link rel="apple-touch-icon" sizes="120x120" href="/touch-icon-iphone-retina.png"/>
  <link rel="apple-touch-icon" sizes="152x152" href="/touch-icon-ipad-retina.png"/>
  <link rel="icon" sizes="16x16 24x24 32x32 48x48 64x64" type="image/vnd.microsoft.icon" href="/favicon.ico"/>
  <link rel="mask-icon" sizes="any" href="/website_icon.svg" color="black"/>
  <link rel="author" type="text/plain" href="http://nshipster.com/humans.txt"/>

  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:site" content="@NSHipster"/>
  
  <meta name="twitter:creator" content="@kattrali"/>
  
  
    <meta name="twitter:title" content="NSUndoManager"/>
    <meta name="twitter:description" content="We all make mistakes. Thankfully, Foundation comes to our rescue for more than just our misspellings. Cocoa includes a simple yet robust API for undoing or redoing actions through NSUndoManager."/>
  
  <meta property="twitter:account_id" content="629523445"/>

  <meta property="og:site_name" content="NSHipster"/>
  <meta property="og:image" content="http://nshipster.com/touch-icon-ipad-retina.png"/>
  
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="NSUndoManager"/>
    <meta property="og:url" content="http://nshipster.com/nsundomanager/"/>
    <meta property="og:description" content="We all make mistakes. Thankfully, Foundation comes to our rescue for more than just our misspellings. Cocoa includes a simple yet robust API for undoing or redoing actions through NSUndoManager."/>
    <meta property="article:published_time" content="2014-12-15T00:00:00-08:00"/>
    <meta property="article:modified_time" content="2015-12-09T21:34:50-08:00"/>
    <meta property="article:tag" content="cocoa"/>
    <meta property="article:publisher" content="https://www.facebook.com/NSHipster">
  

  
    <meta property="st:title" content="NSUndoManager"/>
    <meta property="st:type" content="article"/>
  
  
  <meta property="nshipster:hide-single-lang" content="swift,objective-c"/>
</head>

<body itemscope itemtype="http://schema.org/WebPage">

  <script src="http://nshipster.com/js/zepto.min.js"></script>
  <script src="http://nshipster.com/js/application.js"></script>

  <div role="container">
    <header role="banner">
      <h1 id="logo">
        <a href="/">
          <svg id="ns" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 79.5 45.7" enable-background="new 0 0 79.5 45.7" xml:space="preserve">
<g>
  <path fill="#F58020" d="M0.6,1h13.7L27,24.4h0.1V1h12.7v43.6H26.8L13.4,20.8h-0.1v23.8H0.6V1z"/>
  <path fill="#F58020" d="M51.4,30c0,1.1,0.2,2.1,0.5,2.9c1,2.6,3.9,3.2,6.4,3.2c2.2,0,5.6-0.7,5.6-4c0-2.3-1.9-2.9-9.4-5
    c-6.9-2-14.8-3.8-14.8-12.6C39.7,4.3,48.3,0,57.3,0c9.5,0,17.8,3.6,18.2,14.2H62.8c0.2-1.6-0.5-2.7-1.6-3.5
    c-1.1-0.8-2.6-1.1-4-1.1c-1.8,0-4.8,0.5-4.8,2.9c0.2,3.1,6.5,3.8,12.6,5.5c6.2,1.7,12.3,4.6,12.3,12.6c0,11.4-10.4,15-20.1,15
    c-4.9,0-19-1.8-19.2-15.7H51.4z"/>
</g>
</svg>

          <svg id="mustache" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 79.5 45.7" enable-background="new 0 0 79.5 45.7" xml:space="preserve">
  <g transform="translate(0,-952.36217)" opacity="0.95">
    <path id="path2987" fill="#010101" d="M28.2,971.4c-10,0.5-19.1,13.3-28.2,2.1c0,15.1,23.7,30.5,39.8,16.3
      c16,14.1,39.8-1.3,39.8-16.3c-12.5,15.4-25-14.4-39.8,4.5C35.8,972.7,31.9,971.2,28.2,971.4z"/>
  </g>
</svg>

        </a>

        <span hidden style="display:none;">NSHipster</span>
      </h1>

      <form role="search">
        <input type="text" id="st-search-input" class="st-search-input" />
      </form>

      
    </header>

    <div id="main" role="main" itemprop="mainContentOfPage">
      

<article role="article" itemscope itemtype="http://schema.org/Article">
  <header role="heading">
    <h1 class="title" itemprop="name">
      <a href="/nsundomanager/">NSUndo​Manager</a>
    </h1>

    <h2>
    
      Written by <a class="author" href="/authors/delisa-mason/">Delisa Mason</a> —
    
    <time datetime="2014-12-15T00:00:00-08:00" itemprop="datePublished">December 15<sup>th</sup>, 2014</time>
    
    </h2>

  </header>

  <div class="content" itemprop="articleBody" data-swiftype-index="true">
    <p>We all make mistakes. Thankfully, Foundation comes to our rescue for more than just our misspellings. Cocoa includes a simple yet robust API for undoing or redoing actions through <code>NSUndoManager</code>.</p>

<p>By default, each application window has an undo manager, and any object in the responder chain can manage a custom undo manager for performing undo and redo operations local to their respective view. <code>UITextField</code> and <code>UITextView</code> use this functionality to automatically provide support for undoing text edits while first responder. However, indicating whether other actions can be undone is an exercise left for the app developer.</p>

<p>Creating an undoable action requires three steps: performing a change, registering an &ldquo;undo operation&rdquo; which can reverse the change, and responding to a request to undo the change.</p>

<h2 id="undo-operations">Undo Operations</h2>

<p>To show an action can be undone, register an &ldquo;undo operation&rdquo; while performing the action. The <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/UndoArchitecture/Articles/UndoManager.html#//apple_ref/doc/uid/20000205-CJBDJCCJ">Undo Architecture</a> documentation defines an &ldquo;undo operation&rdquo; as:</p>

<blockquote>
<p>A method for reverting a change to an object, along with the arguments needed to revert the change.</p>
</blockquote>

<p>The operation specifies:</p>

<ul>
<li>The object to receive a message if an undo is requested</li>
<li>The message to send and</li>
<li>The arguments to pass with the message</li>
</ul>

<p>If the method invoked by the undo operation also registers an undo operation, the undo manager provides redo support without extra work, as it is &ldquo;undoing the undo&rdquo;.</p>

<p>There are two types of undo operations, &ldquo;simple&rdquo; selector-based undo and complex &ldquo;NSInvocation-based undo&rdquo;.</p>

<h3 id="registering-a-simple-undo-operation">Registering a Simple Undo Operation</h3>

<p>To register a simple undo operation, invoke <code>NSUndoManger -registerUndoWithTarget:selector:object:</code> on a target which can undo the action. The target is not necessarily the modified object, and is often a utility or container which manages the object&rsquo;s state. Specify the name of the undo action at the same time, using <code>NSUndoManager -setActionName:</code>. The undo dialog shows the name of the action, so it should be localized.</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">func</span> <span class="nf">updateScore</span><span class="p">(</span><span class="nl">score</span><span class="p">:</span> <span class="bp">NSNumber</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">undoManager</span><span class="p">.</span><span class="n">registerUndoWithTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="nl">selector</span><span class="p">:</span><span class="n">Selector</span><span class="p">(</span><span class="s">&quot;updateScore:&quot;</span><span class="p">),</span> <span class="nl">object</span><span class="p">:</span><span class="n">myMovie</span><span class="p">.</span><span class="n">score</span><span class="p">)</span>
    <span class="n">undoManager</span><span class="p">.</span><span class="n">setActionName</span><span class="p">(</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">&quot;actions.update&quot;</span><span class="p">,</span> <span class="nl">comment</span><span class="p">:</span> <span class="s">&quot;Update Score&quot;</span><span class="p">))</span>
    <span class="n">myMovie</span><span class="p">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">updateScore:</span><span class="p">(</span><span class="bp">NSNumber</span><span class="o">*</span><span class="p">)</span><span class="nv">score</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">undoManager</span> <span class="nl">registerUndoWithTarget</span><span class="p">:</span><span class="nb">self</span> <span class="nl">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">updateScore</span><span class="p">:)</span> <span class="nl">object</span><span class="p">:</span><span class="n">myMovie</span><span class="p">.</span><span class="n">score</span><span class="p">];</span>
    <span class="p">[</span><span class="n">undoManager</span> <span class="nl">setActionName</span><span class="p">:</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">@&quot;actions.update&quot;</span><span class="p">,</span> <span class="s">@&quot;Update Score&quot;</span><span class="p">)];</span>
    <span class="n">myMovie</span><span class="p">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="registering-a-complex-undo-operation-with-nsinvocation">Registering a Complex Undo Operation with NSInvocation</h3>

<p>Simple undo operations may be too rigid for some uses, as undoing an action may require more than one argument. In these cases, we can leverage <code>NSInvocation</code> to record the selector and arguments required. Calling <code>prepareWithInvocationTarget:</code> records which object will receive the message which will make the change.</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">func</span> <span class="nf">movePiece</span><span class="p">(</span><span class="nl">piece</span><span class="p">:</span> <span class="n">ChessPiece</span><span class="p">,</span> <span class="nl">row</span><span class="p">:</span><span class="n">UInt</span><span class="p">,</span> <span class="nl">column</span><span class="p">:</span><span class="n">UInt</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nl">undoController</span> <span class="p">:</span> <span class="n">ViewController</span> <span class="o">=</span> <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">prepareWithInvocationTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="kt">as</span> <span class="n">ViewController</span>
    <span class="n">undoController</span><span class="p">.</span><span class="n">movePiece</span><span class="p">(</span><span class="n">piece</span><span class="p">,</span> <span class="nl">row</span><span class="p">:</span><span class="n">piece</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="nl">column</span><span class="p">:</span><span class="n">piece</span><span class="p">.</span><span class="n">column</span><span class="p">)</span>
    <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">setActionName</span><span class="p">(</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">&quot;actions.move-piece&quot;</span><span class="p">,</span> <span class="s">&quot;Move Piece&quot;</span><span class="p">))</span>

    <span class="n">piece</span><span class="p">.</span><span class="n">row</span> <span class="o">=</span> <span class="n">row</span>
    <span class="n">piece</span><span class="p">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">column</span>
    <span class="n">updateChessboard</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">movePiece:</span><span class="p">(</span><span class="n">ChessPiece</span><span class="o">*</span><span class="p">)</span><span class="nv">piece</span> <span class="nf">toRow:</span><span class="p">(</span><span class="bp">NSUInteger</span><span class="p">)</span><span class="nv">row</span> <span class="nf">column:</span><span class="p">(</span><span class="bp">NSUInteger</span><span class="p">)</span><span class="nv">column</span> <span class="p">{</span>
    <span class="p">[[</span><span class="n">undoManager</span> <span class="nl">prepareWithInvocationTarget</span><span class="p">:</span><span class="nb">self</span><span class="p">]</span> <span class="nl">movePiece</span><span class="p">:</span><span class="n">piece</span> <span class="nl">ToRow</span><span class="p">:</span><span class="n">piece</span><span class="p">.</span><span class="n">row</span> <span class="nl">column</span><span class="p">:</span><span class="n">piece</span><span class="p">.</span><span class="n">column</span><span class="p">];</span>
    <span class="p">[</span><span class="n">undoManager</span> <span class="nl">setActionName</span><span class="p">:</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">@&quot;actions.move-piece&quot;</span><span class="p">,</span> <span class="s">@&quot;Move Piece&quot;</span><span class="p">)];</span>

    <span class="n">piece</span><span class="p">.</span><span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">;</span>
    <span class="n">piece</span><span class="p">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">column</span><span class="p">;</span>
    <span class="p">[</span><span class="nb">self</span> <span class="n">updateChessboard</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p>The magic here is that <code>NSUndoManager</code> implements <code>forwardInvocation:</code>. When the undo manager receives the message to undo <code>-movePiece:row:column:</code>, it forwards the message to the target since <code>NSUndoManager</code> does not implement this method.</p>

<h2 id="performing-an-undo">Performing an Undo</h2>

<p>Once undo operations are registered, actions can be undone and redone as needed, using <code>NSUndoManager -undo</code> and <code>NSUndoManager -redo</code>.</p>

<h3 id="responding-to-the-shake-gesture-on-ios">Responding to the Shake Gesture on iOS</h3>

<p>By default, users trigger an undo operation by shaking the device. If a view controller should handle an undo request, the view controller must:</p>

<ol>
<li>Be able to become first responder</li>
<li>Become first responder once its view appears,</li>
<li>Resign first responder when its view disappears</li>
</ol>

<p>When the view controller then receives the motion event, the operating system presents a dialog to the user when undo or redo actions are available. The <code>undoManager</code> property of the view controller will handle the user&rsquo;s choice without further involvement.</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">class</span> <span class="nl">ViewController</span><span class="p">:</span> <span class="bp">UIViewController</span> <span class="p">{</span>
    <span class="kr">override</span> <span class="k">func</span> <span class="n">viewDidAppear</span><span class="p">(</span><span class="nl">animated</span><span class="p">:</span> <span class="n">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">super</span><span class="p">.</span><span class="n">viewDidAppear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
        <span class="n">becomeFirstResponder</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kr">override</span> <span class="k">func</span> <span class="n">viewWillDisappear</span><span class="p">(</span><span class="nl">animated</span><span class="p">:</span> <span class="n">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">super</span><span class="p">.</span><span class="n">viewWillDisappear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
        <span class="n">resignFirstResponder</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kr">override</span> <span class="k">func</span> <span class="n">canBecomeFirstResponder</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">true</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="k">@implementation</span> <span class="nc">ViewController</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidAppear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="nl">viewDidAppear</span><span class="p">:</span><span class="n">animated</span><span class="p">];</span>
    <span class="p">[</span><span class="nb">self</span> <span class="n">becomeFirstResponder</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewWillDisappear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="nl">viewWillDisappear</span><span class="p">:</span><span class="n">animated</span><span class="p">];</span>
    <span class="p">[</span><span class="nb">self</span> <span class="n">resignFirstResponder</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">canBecomeFirstResponder</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ...</span>

<span class="k">@end</span>
</code></pre></div>
<h2 id="customizing-the-undo-stack">Customizing the Undo Stack</h2>

<h3 id="grouping-actions-together">Grouping Actions Together</h3>

<p>All undo operations registered during a single run loop will be undone together, unless &ldquo;undo groups&rdquo; are otherwise specified. Grouping allows undoing or redoing many actions at once. Although each action can be performed and undone individually, if the user performs two at once, undoing both at once preserves a consistent user experience.</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">func</span> <span class="nf">readAndArchiveEmail</span><span class="p">(</span><span class="nl">email</span><span class="p">:</span> <span class="n">Email</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">beginUndoGrouping</span><span class="p">()</span>
    <span class="n">markEmail</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="nl">read</span><span class="p">:</span> <span class="nb">true</span><span class="p">)</span>
    <span class="n">archiveEmail</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
    <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">setActionName</span><span class="p">(</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">&quot;actions.read-archive&quot;</span><span class="p">,</span> <span class="nl">comment</span><span class="p">:</span><span class="s">&quot;Mark as Read and Archive&quot;</span><span class="p">))</span>
    <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">endUndoGrouping</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="nf">markEmail</span><span class="p">(</span><span class="nl">email</span><span class="p">:</span> <span class="n">Email</span><span class="p">,</span> <span class="nl">read</span><span class="p">:</span><span class="n">Bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nl">undoController</span><span class="p">:</span> <span class="n">ViewController</span> <span class="o">=</span> <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">prepareWithInvocationTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="kt">as</span> <span class="n">ViewController</span>
    <span class="n">undoController</span><span class="p">.</span><span class="n">markEmail</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="nl">read</span><span class="p">:</span><span class="n">email</span><span class="p">.</span><span class="n">read</span><span class="p">)</span>
    <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">setActionName</span><span class="p">(</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">&quot;actions.read&quot;</span><span class="p">,</span> <span class="nl">comment</span><span class="p">:</span><span class="s">&quot;Mark as Read&quot;</span><span class="p">))</span>
    <span class="n">email</span><span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read</span>
<span class="p">}</span>

<span class="k">func</span> <span class="nf">archiveEmail</span><span class="p">(</span><span class="nl">email</span><span class="p">:</span> <span class="n">Email</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nl">undoController</span><span class="p">:</span> <span class="n">ViewController</span> <span class="o">=</span> <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">prepareWithInvocationTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="kt">as</span> <span class="n">ViewController</span>
    <span class="n">undoController</span><span class="p">.</span><span class="n">moveEmail</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="nl">toFolder</span><span class="p">:</span><span class="s">&quot;Inbox&quot;</span><span class="p">)</span>
    <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">setActionName</span><span class="p">(</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">&quot;actions.archive&quot;</span><span class="p">,</span> <span class="nl">comment</span><span class="p">:</span><span class="s">&quot;Archive&quot;</span><span class="p">))</span>
    <span class="n">moveEmail</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="nl">toFolder</span><span class="p">:</span><span class="s">&quot;All Mail&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">readAndArchiveEmail:</span><span class="p">(</span><span class="n">Email</span><span class="o">*</span><span class="p">)</span><span class="nv">email</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">undoManager</span> <span class="n">beginUndoGrouping</span><span class="p">];</span>
    <span class="p">[</span><span class="nb">self</span> <span class="nl">markEmail</span><span class="p">:</span><span class="n">email</span> <span class="nl">asRead</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
    <span class="p">[</span><span class="nb">self</span> <span class="nl">archiveEmail</span><span class="p">:</span><span class="n">email</span><span class="p">];</span>
    <span class="p">[</span><span class="n">undoManager</span> <span class="nl">setActionName</span><span class="p">:</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">@&quot;actions.read-archive&quot;</span><span class="p">,</span> <span class="s">@&quot;Mark as Read and Archive&quot;</span><span class="p">)];</span>
    <span class="p">[</span><span class="n">undoManager</span> <span class="n">endUndoGrouping</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">markEmail:</span><span class="p">(</span><span class="n">Email</span><span class="o">*</span><span class="p">)</span><span class="nv">email</span> <span class="nf">asRead:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">isRead</span> <span class="p">{</span>
    <span class="p">[[</span><span class="n">undoManager</span> <span class="nl">prepareWithInvocationTarget</span><span class="p">:</span><span class="nb">self</span><span class="p">]</span> <span class="nl">markEmail</span><span class="p">:</span><span class="n">email</span> <span class="nl">asRead</span><span class="p">:[</span><span class="n">email</span> <span class="n">isRead</span><span class="p">]];</span>
    <span class="p">[</span><span class="n">undoManager</span> <span class="nl">setActionName</span><span class="p">:</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">@&quot;actions.read&quot;</span><span class="p">,</span> <span class="s">@&quot;Mark as Read&quot;</span><span class="p">)];</span>
    <span class="n">email</span><span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">isRead</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">archiveEmail:</span><span class="p">(</span><span class="n">Email</span><span class="o">*</span><span class="p">)</span><span class="nv">email</span> <span class="p">{</span>
    <span class="p">[[</span><span class="n">undoManager</span> <span class="nl">prepareWithInvocationTarget</span><span class="p">:</span><span class="nb">self</span><span class="p">]</span> <span class="nl">moveEmail</span><span class="p">:</span><span class="n">email</span> <span class="nl">toFolder</span><span class="p">:</span><span class="s">@&quot;Inbox&quot;</span><span class="p">];</span>
    <span class="p">[</span><span class="n">undoManager</span> <span class="nl">setActionName</span><span class="p">:</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">@&quot;actions.archive&quot;</span><span class="p">,</span> <span class="s">@&quot;Archive&quot;</span><span class="p">)];</span>
    <span class="p">[</span><span class="nb">self</span> <span class="nl">moveEmail</span><span class="p">:</span><span class="n">email</span> <span class="nl">toFolder</span><span class="p">:</span><span class="s">@&quot;All Mail&quot;</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="clearing-the-stack">Clearing the Stack</h3>

<p>Sometimes the undo manager&rsquo;s list of actions should be cleared to avoid confusing the user with unexpected results. The most common cases are when the context changes dramatically, like changing the visible view controller on iOS or externally made changes occurring on an open document. When that time comes, the undo manager&rsquo;s stack can be cleared using <code>NSUndoManager -removeAllActions</code> or <code>NSUndoManager -removeAllActionsWithTarget:</code> if finer granularity is needed.</p>

<h2 id="caveats">Caveats</h2>

<p>If an action has different names for undo versus redo, check whether an undo operation is occurring before setting the action name to ensure the title of the undo dialog reflects which action will be undone. An example would be a pair of opposing operations, like adding and removing an object:</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">func</span> <span class="nf">addItem</span><span class="p">(</span><span class="nl">item</span><span class="p">:</span> <span class="bp">NSObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">registerUndoWithTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="nl">selector</span><span class="p">:</span> <span class="n">Selector</span><span class="p">(</span><span class="s">&quot;removeItem:&quot;</span><span class="p">),</span> <span class="nl">object</span><span class="p">:</span><span class="n">item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">undoing</span> <span class="o">==</span> <span class="nb">false</span> <span class="p">{</span>
        <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">setActionName</span><span class="p">(</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">&quot;action.add-item&quot;</span><span class="p">,</span> <span class="nl">comment</span><span class="p">:</span> <span class="s">&quot;Add Item&quot;</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="n">myArray</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="nf">removeItem</span><span class="p">(</span><span class="nl">item</span><span class="p">:</span> <span class="bp">NSObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="n">index</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">myArray</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">registerUndoWithTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="nl">selector</span><span class="p">:</span> <span class="n">Selector</span><span class="p">(</span><span class="s">&quot;addItem:&quot;</span><span class="p">),</span> <span class="nl">object</span><span class="p">:</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">undoing</span> <span class="o">==</span> <span class="nb">false</span> <span class="p">{</span>
            <span class="n">undoManager</span><span class="o">?</span><span class="p">.</span><span class="n">setActionName</span><span class="p">(</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">&quot;action.remove-item&quot;</span><span class="p">,</span> <span class="nl">comment</span><span class="p">:</span> <span class="s">&quot;Remove Item&quot;</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="n">myArray</span><span class="p">.</span><span class="n">removeAtIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">addItem:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">item</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">undoManager</span> <span class="nl">registerUndoWithTarget</span><span class="p">:</span><span class="nb">self</span> <span class="nl">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">removeItem</span><span class="p">:)</span> <span class="nl">object</span><span class="p">:</span><span class="n">item</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">undoManager</span> <span class="n">isUndoing</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">undoManager</span> <span class="nl">setActionName</span><span class="p">:</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">@&quot;actions.add-item&quot;</span><span class="p">,</span> <span class="s">@&quot;Add Item&quot;</span><span class="p">)];</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">myArray</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">item</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">removeItem:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">item</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">undoManager</span> <span class="nl">registerUndoWithTarget</span><span class="p">:</span><span class="nb">self</span> <span class="nl">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">addItem</span><span class="p">:)</span> <span class="nl">object</span><span class="p">:</span><span class="n">item</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">undoManager</span> <span class="n">isUndoing</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">undoManager</span> <span class="nl">setActionName</span><span class="p">:</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">@&quot;actions.remove-item&quot;</span><span class="p">,</span> <span class="s">@&quot;Remove Item&quot;</span><span class="p">)];</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">myArray</span> <span class="nl">removeObject</span><span class="p">:</span><span class="n">item</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p>If your test framework runs many tests as a part of one run loop (like Kiwi), clear the undo stack between tests in <code>teardown</code>. Otherwise tests will share undo state and invoking <code>NSUndoManager -undo</code> during a test may lead to unexpected results.</p>

<hr>

<p>There are even more ways to refine behavior with <code>NSUndoManager</code>, particularly for grouping actions and managing scope. Apple also provides <a href="https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/MobileHIG/UndoRedo.html">usability guidelines</a> for making undo and redo accessible in an expected and delightful way.</p>

<p>We all may wish to live without mistakes, but Cocoa gives us a way to let our users live with fewer regrets as it makes some actions easily changeable.</p>

  </div>

  <footer role="complementary">
    
    <section id="revisions">
      <small>NSMutableHipster</small>

      <p>
      Questions? Corrections?  <a href="https://github.com/NSHipster/articles/issues">Issues</a> and <a href="https://github.com/NSHipster/articles/blob/master/2014-12-15-nsundomanager.md">pull requests</a> are always welcome — NSHipster is made better by readers like you.
      </p>
      
      <p>
      
        
            <em>This article uses Swift version 1.0.</em>
        
      
      Find status information for all articles on the <a href="/status/">status page</a>.
      </p>
      
      <dl>
      
      </dl>
    </section>
    

    <section id="follow">
      <small>Follow NSHipster</small>

      <ul>
        <li class="twitter">
          <a href="https://twitter.com/intent/user?screen_name=NSHipster" title="Follow NSHipster on Twitter"><i class="icon-twitter" aria-hidden="true"></i></a>
        </li>
        <li class="facebook">
          <a href="https://www.facebook.com/NSHipster" title="Like NSHipster on Facebook"><i class="icon-facebook" aria-hidden="true"></i></a>
        </li>
        <li class="google-plus">
          <a href="https://plus.google.com/+NSHipster" title="Follow NSHipster on G+"><i class="icon-googleplus" aria-hidden="true"></i></a>
        </li>
        <li class="rss">
          <a href="/feed.xml" title="Subscribe to the NSHipster RSS Feed"><i class="icon-feed" aria-hidden="true"></i></a>
        </li>
      </ul>

      <form action="https://tinyletter.com/NSHipster" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/NSHipster', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
        <label for="tlemail" hidden style="display:none;">Enter Your Email Address</label>
        <input type="email" name="email" id="tlemail" placeholder="Your Email Address"/>
        <input type="hidden" name="embed" value="1"/>
        <input type="submit" value="Join the Newsletter"/>
      </form>
    </section>

    <section id="attribution">
      
  <div class="contributor" itemprop="author" itemscope itemtype="http://data-vocabulary.org/Person">
    <small>Written by</small>

    <img class="avatar" alt="Delisa Mason" itemprop="image" src="http://nshipster.s3.amazonaws.com/delisa-mason.jpg" draggable="false"/>
    <div class="details">
      <span itemprop="name"><a href="/authors/delisa-mason/">Delisa Mason</a></span>

      <p><a href="http://delisa.me">Delisa Mason</a> (<a href="https://twitter.com/kattrali">@kattrali</a>) is the creator of the Xcode Package Manager, <a href="http://alcatraz.io">Alcatraz</a>, as well as a <a href="http://cocoapods.org">CocoaPods</a> Core Team member.</p>


      
        <a href="https://plus.google.com/?rel=author" rel="author"></a>
      
    </div>
  </div>


    </section>

    

    

    <section>
      <div id="continue">
        <small>Next Article</small>
        
        

          <article>
            <h1 class="title">
              <a href="/the-death-of-cocoa/" title="The Death of Cocoa" rel="next">The Death of Cocoa</a>
            </h1>

            <p>For many of us, the simplicity, elegance, and performance of Apple&rsquo;s hardware and software working together are the reason why we build on their platforms. And yet, after just a few months of working with Swift, Cocoa has begun to lose its luster.</p>

          </article>
      </div>

      
      
        
        
      

      <div id="related">
        <small>Related Articles</small>

        <ul>
          
          
          
            <li>
              <a href="/nsdatecomponents/" title="NSDateComponents">NSDateComponents</a>
            </li>
            
          
          
            <li>
              <a href="/uiprintinteractioncontroller/" title="UIPrintInteractionController">UIPrintInteractionController</a>
            </li>
            
          
          
            <li>
              <a href="/mkgeodesicpolyline/" title="MKGeodesicPolyline">MKGeodesicPolyline</a>
            </li>
            
          
          
            <li>
              <a href="/addressbookui/" title="AddressBookUI">AddressBookUI</a>
            </li>
            
          
        </ul>
      </div>
    </section>
  </footer>
</article>

    </div>

    <footer role="contentinfo">
      <section class="credits colophon">
        <p>
          Questions? Corrections? <a href="https://twitter.com/NSHipster">@NSHipster</a> or <a href="https://github.com/NSHipster/articles">on GitHub</a>.
        </p>
        <p>
          <i aria-hidden="true" class="icon-cc"></i>
          <i aria-hidden="true" class="icon-cc-by"></i>
          <i aria-hidden="true" class="icon-cc-nc"></i>
          NSHipster.com is released under a <a href="http://creativecommons.org/licenses/by-nc/4.0/" rel="license">Creative Commons BY-NC License</a>.
        </p>
        <p><abbr title="International Standard Serial Number">ISSN</abbr> 2373-9800</p>
        <p lang="zh-Hans"><a href="http://nshipster.cn" hreflang="zh-Hans" title="Articles also available in Chinese">文章也可在中文版阅读</a>。</p>
        <a href="https://plus.google.com/105091289906267717942" rel="publisher"></a>
      </section>
    </footer>
  </div>

  <script>
    if (window.navigator && window.navigator.loadPurpose === "preview") {
      window.location.href = "http://nshipster.com/topsites_preview.html";
    }
  </script>

  <script async>
    var Swiftype = window.Swiftype || {};
    (function() {
      Swiftype.key = 'Q5jNBiR8qVs5xE5dNect';
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.async = true;
      script.src = "//swiftype.com/embed.js";
      var entry = document.getElementsByTagName('script')[0];
      document.getElementsByTagName('script')[0].parentNode.insertBefore(script, entry);
    }());
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-49868484-1', 'nshipster.com');
    ga('send', 'pageview');
  </script>

</body>
</html>
