<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  
    <title>instancetype - NSHipster</title>
    <meta name="description" content="Objective-C is a rapidly evolving language, in a way that you just don't see in established programming languages. Developments range from the mundane to paradigm-changing, but telling the difference takes practice. Because we're talking about low-level language features, it's difficult to understand what implications they may have higher up with API design."/>
    <link rel="canonical" href="http://nshipster.com/instancetype/"/>
  
  
  
  
  <meta name="author" content="Mattt Thompson"/>
  
  <meta name="revisit-after" content="7 days"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"/>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://nshipster.com/feed.xml"/>
  <link rel="stylesheet" type="text/css" href="http://nshipster.com/css/screen.css"/>
  <link rel="apple-touch-icon" href="/touch-icon-iphone.png"/>
  <link rel="apple-touch-icon" sizes="76x76" href="/touch-icon-ipad.png"/>
  <link rel="apple-touch-icon" sizes="120x120" href="/touch-icon-iphone-retina.png"/>
  <link rel="apple-touch-icon" sizes="152x152" href="/touch-icon-ipad-retina.png"/>
  <link rel="icon" sizes="16x16 24x24 32x32 48x48 64x64" type="image/vnd.microsoft.icon" href="/favicon.ico"/>
  <link rel="mask-icon" sizes="any" href="/website_icon.svg" color="black"/>
  <link rel="author" type="text/plain" href="http://nshipster.com/humans.txt"/>

  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:site" content="@NSHipster"/>
  
  <meta name="twitter:creator" content="@mattt"/>
  
  
    <meta name="twitter:title" content="instancetype"/>
    <meta name="twitter:description" content="Objective-C is a rapidly evolving language, in a way that you just don&#39;t see in established programming languages. Developments range from the mundane to paradigm-changing, but telling the difference takes practice. Because we&#39;re talking about low-level language features, it&#39;s difficult to understand what implications they may have higher up with API design."/>
  
  <meta property="twitter:account_id" content="629523445"/>

  <meta property="og:site_name" content="NSHipster"/>
  <meta property="og:image" content="http://nshipster.com/touch-icon-ipad-retina.png"/>
  
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="instancetype"/>
    <meta property="og:url" content="http://nshipster.com/instancetype/"/>
    <meta property="og:description" content="Objective-C is a rapidly evolving language, in a way that you just don&#39;t see in established programming languages. Developments range from the mundane to paradigm-changing, but telling the difference takes practice. Because we&#39;re talking about low-level language features, it&#39;s difficult to understand what implications they may have higher up with API design."/>
    <meta property="article:published_time" content="2012-12-10T00:00:00-08:00"/>
    <meta property="article:modified_time" content="2015-12-09T21:34:50-08:00"/>
    <meta property="article:tag" content="objective-c"/>
    <meta property="article:publisher" content="https://www.facebook.com/NSHipster">
  

  
    <meta property="st:title" content="instancetype"/>
    <meta property="st:type" content="article"/>
  
  
  <meta property="nshipster:hide-single-lang" content="swift,objective-c"/>
</head>

<body itemscope itemtype="http://schema.org/WebPage">

  <script src="http://nshipster.com/js/zepto.min.js"></script>
  <script src="http://nshipster.com/js/application.js"></script>

  <div role="container">
    <header role="banner">
      <h1 id="logo">
        <a href="/">
          <svg id="ns" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 79.5 45.7" enable-background="new 0 0 79.5 45.7" xml:space="preserve">
<g>
  <path fill="#F58020" d="M0.6,1h13.7L27,24.4h0.1V1h12.7v43.6H26.8L13.4,20.8h-0.1v23.8H0.6V1z"/>
  <path fill="#F58020" d="M51.4,30c0,1.1,0.2,2.1,0.5,2.9c1,2.6,3.9,3.2,6.4,3.2c2.2,0,5.6-0.7,5.6-4c0-2.3-1.9-2.9-9.4-5
    c-6.9-2-14.8-3.8-14.8-12.6C39.7,4.3,48.3,0,57.3,0c9.5,0,17.8,3.6,18.2,14.2H62.8c0.2-1.6-0.5-2.7-1.6-3.5
    c-1.1-0.8-2.6-1.1-4-1.1c-1.8,0-4.8,0.5-4.8,2.9c0.2,3.1,6.5,3.8,12.6,5.5c6.2,1.7,12.3,4.6,12.3,12.6c0,11.4-10.4,15-20.1,15
    c-4.9,0-19-1.8-19.2-15.7H51.4z"/>
</g>
</svg>

          <svg id="mustache" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 79.5 45.7" enable-background="new 0 0 79.5 45.7" xml:space="preserve">
  <g transform="translate(0,-952.36217)" opacity="0.95">
    <path id="path2987" fill="#010101" d="M28.2,971.4c-10,0.5-19.1,13.3-28.2,2.1c0,15.1,23.7,30.5,39.8,16.3
      c16,14.1,39.8-1.3,39.8-16.3c-12.5,15.4-25-14.4-39.8,4.5C35.8,972.7,31.9,971.2,28.2,971.4z"/>
  </g>
</svg>

        </a>

        <span hidden style="display:none;">NSHipster</span>
      </h1>

      <form role="search">
        <input type="text" id="st-search-input" class="st-search-input" />
      </form>

      
    </header>

    <div id="main" role="main" itemprop="mainContentOfPage">
      

<article role="article" itemscope itemtype="http://schema.org/Article">
  <header role="heading">
    <h1 class="title" itemprop="name">
      <a href="/instancetype/">instancetype</a>
    </h1>

    <h2>
    
      Written by <a class="author" href="/authors/mattt-thompson/">Mattt Thompson</a> —
    
    <time datetime="2012-12-10T00:00:00-08:00" itemprop="datePublished">December 10<sup>th</sup>, 2012</time>
    
    </h2>

  </header>

  <div class="content" itemprop="articleBody" data-swiftype-index="true">
    <p>Want to know what&rsquo;s coming next in Objective-C? <a href="http://clang.llvm.org/docs/LanguageExtensions.html">Keep your ear to the ground</a>.</p>

<p>Objective-C is a rapidly evolving language, in a way that you just don&rsquo;t see in established programming languages. ARC, object literals, subscripting, blocks: in the span of just three years, so much of how we program in Objective-C has been changed (for the better).</p>

<p>All of this innovation is a result of Apple&rsquo;s philosophy of vertical integration. Just as Apple&rsquo;s investment in designing <a href="http://en.wikipedia.org/wiki/Apple_A4">its own chipsets</a> gave them leverage to compete aggressively with their mobile hardware, so too has their investment in <a href="http://llvm.org">LLVM</a> allowed their software to keep pace.</p>

<p>Clang developments range from the mundane to paradigm-changing, but telling the difference takes practice. Because we&rsquo;re talking about low-level language features, it&rsquo;s difficult to understand what implications they may have higher up with API design.</p>

<p>One such example is <code>instancetype</code>, the subject of this week&rsquo;s article.</p>

<hr>

<p>In Objective-C, conventions aren&rsquo;t just a matter of coding best-practices, they are implicit instructions to the compiler.</p>

<p>For example, <code>alloc</code> and <code>init</code> both have return types of <code>id</code>, yet in Xcode, the compiler makes all of the correct type checks. How is this possible?</p>

<p>In Cocoa, there is a convention that methods with names like <code>alloc</code>, or <code>init</code> always return objects that are an instance of the receiver class. These methods are said to have a <strong>related result type</strong>.</p>

<p>Class constructor methods, although they similarly return <code>id</code>, don&rsquo;t get the same type-checking benefit, because they don&rsquo;t follow that naming convention.</p>

<p>You can try this out for yourself:</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">[[[</span><span class="bp">NSArray</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">]</span> <span class="n">mediaPlaybackAllowsAirPlay</span><span class="p">];</span> <span class="c1">// ❗ &quot;No visible @interface for `NSArray` declares the selector `mediaPlaybackAllowsAirPlay`&quot;</span>

<span class="p">[[</span><span class="bp">NSArray</span> <span class="n">array</span><span class="p">]</span> <span class="n">mediaPlaybackAllowsAirPlay</span><span class="p">];</span> <span class="c1">// (No error)</span>
</code></pre></div>
<p>Because <code>alloc</code> and <code>init</code> follow the naming convention for being a related result type, the correct type check against <code>NSArray</code> is performed. However, the equivalent class constructor <code>array</code> does not follow that convention, and is interpreted as <code>id</code>.</p>

<p><code>id</code> is useful for opting-out of type safety, but losing it when you <em>do</em> want it sucks.</p>

<p>The alternative, of explicitly declaring the return type (<code>(NSArray *)</code> in the previous example) is a slight improvement, but is annoying to write, and doesn&rsquo;t play nicely with subclasses.</p>

<p>This is where the compiler steps in to resolve this timeless edge case to the Objective-C type system:</p>

<p><code>instancetype</code> is a contextual keyword that can be used as a result type to signal that a method returns a related result type. For example:</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="k">@interface</span> <span class="nc">Person</span>
<span class="p">+</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">personWithName:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">name</span><span class="p">;</span>
<span class="k">@end</span>
</code></pre></div>
<blockquote>
<p><code>instancetype</code>, unlike <code>id</code>, can only be used as the result type in a method declaration.</p>
</blockquote>

<p>With <code>instancetype</code>, the compiler will correctly infer that the result of <code>+personWithName:</code> is an instance of a <code>Person</code>.</p>

<p>Look for class constructors in Foundation to start using <code>instancetype</code> in the near future. New APIs, such as <a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UICollectionViewLayoutAttributes_class/Reference/Reference.html">UICollectionViewLayoutAttributes</a> are using <code>instancetype</code> already.</p>

<h2 id="further-implications">Further Implications</h2>

<p>Language features are particularly interesting because, again, it&rsquo;s often unclear of what impact they&rsquo;ll have on higher-level aspects of software design.</p>

<p>While <code>instancetype</code> may seem to be a rather mundane, albeit welcome addition to the compiler, it can be used to some rather clever ends.</p>

<p><a href="https://twitter.com/jonsterling">Jonathan Sterling</a> wrote <a href="http://www.jonmsterling.com/posts/2012-02-05-typed-collections-with-self-types-in-objective-c.html">this quite interesting article</a>, detailing how <code>instancetype</code> could be used to encode statically-typed collections, without <a href="http://en.wikipedia.org/wiki/Generic_programming">generics</a>:</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="bp">NSURL</span> <span class="o">&lt;</span><span class="n">MapCollection</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">sites</span> <span class="o">=</span> <span class="p">(</span><span class="kt">id</span><span class="p">)[</span><span class="bp">NSURL</span> <span class="n">mapCollection</span><span class="p">];</span>
<span class="p">[</span><span class="n">sites</span> <span class="nl">put</span><span class="p">:[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://www.jonmsterling.com/&quot;</span><span class="p">]</span>
        <span class="nl">at</span><span class="p">:</span><span class="s">@&quot;jon&quot;</span><span class="p">];</span>
<span class="p">[</span><span class="n">sites</span> <span class="nl">put</span><span class="p">:[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://www.nshipster.com/&quot;</span><span class="p">]</span>
        <span class="nl">at</span><span class="p">:</span><span class="s">@&quot;nshipster&quot;</span><span class="p">];</span>

<span class="bp">NSURL</span> <span class="o">*</span><span class="n">jonsSite</span> <span class="o">=</span> <span class="p">[</span><span class="n">sites</span> <span class="nl">at</span><span class="p">:</span><span class="s">@&quot;jon&quot;</span><span class="p">];</span> <span class="c1">// =&gt; http://www.jonmsterling.com/</span>
</code></pre></div>
<p>Statically-typed collections would make APIs more expressive&ndash;no longer would a developer be unsure about what kinds of objects are allowed in a collection parameter.</p>

<p>Whether or not this becomes an accepted convention in Objective-C, it&rsquo;s fascinating to how a low-level feature like <code>instancetype</code> can be used to change shape of the language (in this case, making it look more like <a href="http://en.wikipedia.org/wiki/C_Sharp_(programming_language)">C#</a>).</p>

<hr>

<p><code>instancetype</code> is just one of the many language extensions to Objective-C, with more being added with each new release.</p>

<p>Know it, love it.</p>

<p>And take it as an example of how paying attention to the low-level details can give you insights into powerful new ways to transform Objective-C.</p>

  </div>

  <footer role="complementary">
    
    <section id="revisions">
      <small>NSMutableHipster</small>

      <p>
      Questions? Corrections?  <a href="https://github.com/NSHipster/articles/issues">Issues</a> and <a href="https://github.com/NSHipster/articles/blob/master/2012-12-10-instancetype.md">pull requests</a> are always welcome — NSHipster is made better by readers like you.
      </p>
      
      <p>
      
            
      
      Find status information for all articles on the <a href="/status/">status page</a>.
      </p>
      
      <dl>
      
      </dl>
    </section>
    

    <section id="follow">
      <small>Follow NSHipster</small>

      <ul>
        <li class="twitter">
          <a href="https://twitter.com/intent/user?screen_name=NSHipster" title="Follow NSHipster on Twitter"><i class="icon-twitter" aria-hidden="true"></i></a>
        </li>
        <li class="facebook">
          <a href="https://www.facebook.com/NSHipster" title="Like NSHipster on Facebook"><i class="icon-facebook" aria-hidden="true"></i></a>
        </li>
        <li class="google-plus">
          <a href="https://plus.google.com/+NSHipster" title="Follow NSHipster on G+"><i class="icon-googleplus" aria-hidden="true"></i></a>
        </li>
        <li class="rss">
          <a href="/feed.xml" title="Subscribe to the NSHipster RSS Feed"><i class="icon-feed" aria-hidden="true"></i></a>
        </li>
      </ul>

      <form action="https://tinyletter.com/NSHipster" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/NSHipster', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
        <label for="tlemail" hidden style="display:none;">Enter Your Email Address</label>
        <input type="email" name="email" id="tlemail" placeholder="Your Email Address"/>
        <input type="hidden" name="embed" value="1"/>
        <input type="submit" value="Join the Newsletter"/>
      </form>
    </section>

    <section id="attribution">
      
  <div class="contributor" itemprop="author" itemscope itemtype="http://data-vocabulary.org/Person">
    <small>Written by</small>

    <img class="avatar" alt="Mattt Thompson" itemprop="image" src="http://nshipster.s3.amazonaws.com/mattt-thompson.jpg" draggable="false"/>
    <div class="details">
      <span itemprop="name"><a href="/authors/mattt-thompson/">Mattt Thompson</a></span>

      <p><a href="https://github.com/mattt">Mattt Thompson</a> (<a href="https://twitter.com/mattt">@mattt</a>) is a writer and developer from the Rustbelt.</p>


      
        <a href="https://plus.google.com/106751358503565042647?rel=author" rel="author"></a>
      
    </div>
  </div>


    </section>

    

    

    <section>
      <div id="continue">
        <small>Next Article</small>
        
        

          <article>
            <h1 class="title">
              <a href="/cggeometry/" title="CGGeometry" rel="next">CGGeometry</a>
            </h1>

            <p>Unless you were a Math Geek or an Ancient Greek, Geometry was probably not your favorite subject in high school. No, chances are that you were that kid in class who dutifully programmed all of the necessary formulae into your TI-8X calculator. Keeping in the tradition of doing the least amount of math possible, here are some semi-obscure CoreGraphics functions to make your job easier.</p>

          </article>
      </div>

      
      
        
        
      

      <div id="related">
        <small>Related Articles</small>

        <ul>
          
          
          
            <li>
              <a href="/__attribute__/" title="__attribute__">__attribute__</a>
            </li>
            
          
          
            <li>
              <a href="/documentation/" title="Documentation">Documentation</a>
            </li>
            
          
          
            <li>
              <a href="/extended-file-attributes/" title="Extended File Attributes">Extended File Attributes</a>
            </li>
            
          
          
            <li>
              <a href="/clang-diagnostics/" title="Clang Diagnostics">Clang Diagnostics</a>
            </li>
            
          
        </ul>
      </div>
    </section>
  </footer>
</article>

    </div>

    <footer role="contentinfo">
      <section class="credits colophon">
        <p>
          Questions? Corrections? <a href="https://twitter.com/NSHipster">@NSHipster</a> or <a href="https://github.com/NSHipster/articles">on GitHub</a>.
        </p>
        <p>
          <i aria-hidden="true" class="icon-cc"></i>
          <i aria-hidden="true" class="icon-cc-by"></i>
          <i aria-hidden="true" class="icon-cc-nc"></i>
          NSHipster.com is released under a <a href="http://creativecommons.org/licenses/by-nc/4.0/" rel="license">Creative Commons BY-NC License</a>.
        </p>
        <p><abbr title="International Standard Serial Number">ISSN</abbr> 2373-9800</p>
        <p lang="zh-Hans"><a href="http://nshipster.cn" hreflang="zh-Hans" title="Articles also available in Chinese">文章也可在中文版阅读</a>。</p>
        <a href="https://plus.google.com/105091289906267717942" rel="publisher"></a>
      </section>
    </footer>
  </div>

  <script>
    if (window.navigator && window.navigator.loadPurpose === "preview") {
      window.location.href = "http://nshipster.com/topsites_preview.html";
    }
  </script>

  <script async>
    var Swiftype = window.Swiftype || {};
    (function() {
      Swiftype.key = 'Q5jNBiR8qVs5xE5dNect';
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.async = true;
      script.src = "//swiftype.com/embed.js";
      var entry = document.getElementsByTagName('script')[0];
      document.getElementsByTagName('script')[0].parentNode.insertBefore(script, entry);
    }());
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-49868484-1', 'nshipster.com');
    ga('send', 'pageview');
  </script>

</body>
</html>
